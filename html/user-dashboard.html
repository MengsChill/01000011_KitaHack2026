<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartStick | Overview</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/user-dashboard.css">
    
    <style>
        .toast-notification {
            position: fixed; bottom: 30px; right: 30px;
            background: #10b981; color: white; padding: 15px 25px;
            border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: flex; align-items: center; gap: 10px;
            transform: translateY(100px); opacity: 0; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2000; font-weight: 600;
        }
        .toast-notification.show { transform: translateY(0); opacity: 1; }
    </style>
</head>
<body>

    <canvas id="wave-canvas"></canvas>

    <div class="dashboard-wrapper sidebar-collapsed" id="sidebar-wrapper">
        <header class="top-bar">
            <div class="top-bar-left">
                <button id="sidebar-toggle" class="icon-btn"><i class="fas fa-bars"></i></button>
                <a href="user-dashboard.html" class="brand-logo">SMART<span class="highlight">STICK</span></a>
            </div>
            <div class="top-bar-right">
                <button class="icon-btn notification-btn" onclick="showToast('No new notifications', 'info')">
                    <i class="far fa-bell"></i><span class="badge">3</span>
                </button>
                <div class="profile-trigger" id="profile-trigger">
                    <img src="https://ui-avatars.com/api/?name=John+Doe&background=2563eb&color=fff" class="profile-img">
                    <span class="profile-name">John Doe</span>
                </div>
            </div>
        </header>

        <aside class="sidebar">
            <ul class="side-nav">
                <li class="active"><a href="user-dashboard.html"><i class="fas fa-th-large"></i> <span class="link-text">Overview</span></a></li>
                <li><a href="live-haptics.html"><i class="fas fa-wave-square"></i> <span class="link-text">Live Haptics</span></a></li>
                <li><a href="route-history.html"><i class="fas fa-map-marked-alt"></i> <span class="link-text">Route History</span></a></li>
                <li><a href="settings.html"><i class="fas fa-cog"></i> <span class="link-text">Settings</span></a></li>
            </ul>
            <div class="sidebar-footer">
                <a href="homepage.html"><i class="fas fa-sign-out-alt"></i> <span class="link-text">Logout</span></a>
            </div>
        </aside>

        <main class="main-content">
            <div class="content-container">
                <div class="section-gap reveal-on-scroll">
                    <div class="welcome-header">
                        <h1>Welcome back, John</h1>
                        <p class="date-display">Today is Monday, Jan 19, 2026</p>
                    </div>
                </div>

                <div class="widget-grid section-gap">
                    <div class="dash-card status-card reveal-on-scroll">
                        <div class="card-header"><h3>Device Status</h3><span class="status-indicator online">Online</span></div>
                        <div class="card-body">
                            <div class="status-item"><i class="fas fa-battery-three-quarters"></i><div><span class="label">Battery Health</span><span class="value">84%</span></div></div>
                            <div class="status-item"><i class="fas fa-wifi"></i><div><span class="label">Signal Strength</span><span class="value">Strong (5G)</span></div></div>
                        </div>
                    </div>
                    <div class="dash-card reveal-on-scroll">
                        <div class="card-header"><h3>Recent Journey</h3></div>
                        <div class="card-body list-view">
                            <div class="list-item"><i class="fas fa-map-marker-alt icon-bg"></i><div><span class="list-title">Central Park Route</span><span class="list-sub">Today, 10:30 AM â€¢ 2.4 km</span></div></div>
                        </div>
                    </div>
                </div>

                <div class="mobility-banner section-gap reveal-on-scroll">
                    <div class="banner-text">
                        <h2>Regain Your Independence</h2>
                        <p>Your SmartStick learns from your environment to provide safer navigation every day.</p>
                    </div>
                    <div class="banner-image-container">
                        <div class="animation-blob"></div>
                        <div class="slideshow-wrapper walking-motion">
                            <img src="https://cdn-icons-png.flaticon.com/512/3022/3022248.png" class="slide-img img-1">
                            <img src="https://cdn-icons-png.flaticon.com/512/4205/4205572.png" class="slide-img img-2">
                            <img src="https://cdn-icons-png.flaticon.com/512/2829/2829835.png" class="slide-img img-3">
                        </div>
                    </div>
                </div>

                <div class="section-header reveal-on-scroll"><h3>Discover Features</h3></div>
                <div class="horizontal-scroll-container section-gap reveal-on-scroll">
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-moon"></i></div>
                        <h4>Night Vision</h4><p>Enhanced obstacle detection in low-light.</p>
                        <button class="feature-btn" onclick="window.location.href='settings.html'">Configure</button>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-broadcast-tower"></i></div>
                        <h4>SOS Beacon</h4><p>Share live location with contacts.</p>
                        <button class="feature-btn" onclick="showToast('SOS Signal Test Sent!')">Test Signal</button>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-route"></i></div>
                        <h4>Crowd Mapping</h4><p>Suggests safer paths based on data.</p>
                        <button class="feature-btn" onclick="showToast('Crowd Mapping Enabled')">Enable</button>
                    </div>
                </div>

                <div class="section-header reveal-on-scroll"><h3>Quick Navigate</h3></div>
                <div class="horizontal-scroll-container section-gap reveal-on-scroll">
                    <div class="feature-card route-card">
                        <div class="feature-icon route-icon"><i class="fas fa-home"></i></div>
                        <h4>Home Base</h4><p>124 Conifer Drive</p>
                        <button class="feature-btn start-route-btn" onclick="window.location.href='live-haptics.html'"><i class="fas fa-play"></i> Start</button>
                    </div>
                    <div class="feature-card route-card">
                        <div class="feature-icon route-icon"><i class="fas fa-clinic-medical"></i></div>
                        <h4>City Clinic</h4><p>45 Medical Plaza Way</p>
                        <button class="feature-btn start-route-btn" onclick="window.location.href='live-haptics.html'"><i class="fas fa-play"></i> Start</button>
                    </div>
                </div>
            </div>
            
            <footer class="dash-footer reveal-on-scroll">
                <div class="footer-content"><p>&copy; 2026 SMARTSTICK.</p></div>
            </footer>
        </main>
    </div>

    <div id="toast" class="toast-notification"><i class="fas fa-check-circle"></i> <span id="toast-msg">Action Successful</span></div>

    <script type="module">
        // 1. IMPORT FIREBASE FUNCTIONS
        import { logout } from '../js/auth.js';

        // --- SIDEBAR TOGGLE LOGIC ---
        const toggleBtn = document.getElementById('sidebar-toggle');
        const wrapper = document.getElementById('sidebar-wrapper');
        if(toggleBtn && wrapper) {
            toggleBtn.addEventListener('click', () => wrapper.classList.toggle('sidebar-collapsed'));
        }

        // --- LOGOUT BUTTON LOGIC ---
        // We look for the link in the sidebar footer
        const logoutBtn = document.querySelector('.sidebar-footer a');
        if(logoutBtn) {
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault(); // Stop it from just jumping to a page immediately
                logout(); // Call the Firebase logout function
            });
        }

        // --- PROFILE MODAL LOGIC ---
        const profileTrigger = document.getElementById('profile-trigger');
        const profileModal = document.getElementById('profile-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const cancelModalBtn = document.getElementById('cancel-modal');
        const saveModalBtn = document.getElementById('save-modal');
        
        function closeModal() { if(profileModal) profileModal.classList.remove('active'); }
        
        if(profileTrigger) profileTrigger.addEventListener('click', () => profileModal.classList.add('active'));
        if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        if(cancelModalBtn) cancelModalBtn.addEventListener('click', closeModal);
        if(saveModalBtn) saveModalBtn.addEventListener('click', () => { alert("Saved!"); closeModal(); });
        if(profileModal) profileModal.addEventListener('click', (e) => { if (e.target === profileModal) closeModal(); });

        // --- SCROLL ANIMATION OBSERVER ---
        const observerOptions = { threshold: 0.15, rootMargin: "0px 0px -50px 0px" };
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);
        document.querySelectorAll('.reveal-on-scroll').forEach(el => observer.observe(el));

        // --- WAVE ANIMATION ---
        const canvas = document.getElementById('wave-canvas');
        if (canvas) {
            const ctx = canvas.getContext('2d');
            let width, height, increment = 0;
            function resize() { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; }
            window.addEventListener('resize', resize); resize();
            function animate() {
                ctx.fillStyle = "#ffffff"; ctx.fillRect(0, 0, width, height);
                const waves = [
                    { y: height * 0.85, length: 0.01, amplitude: 50, speed: 0.01, color: "rgba(37, 99, 235, 0.05)" },
                    { y: height * 0.85, length: 0.02, amplitude: 30, speed: 0.02, color: "rgba(6, 182, 212, 0.1)" }
                ];
                waves.forEach(wave => {
                    ctx.beginPath(); ctx.moveTo(0, wave.y);
                    for(let i=0; i<width; i++) ctx.lineTo(i, wave.y + Math.sin(i * wave.length + increment * wave.speed * 100) * wave.amplitude);
                    ctx.lineTo(width, height); ctx.lineTo(0, height);
                    ctx.fillStyle = wave.color; ctx.fill();
                });
                increment += 0.01; requestAnimationFrame(animate);
            }
            animate();
        }

        // --- TOAST NOTIFICATION FUNCTION ---
        // (Make this globally available for your buttons)
        window.showToast = function(message) {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toast-msg');
            if(toast && toastMsg) {
                toastMsg.innerText = message;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            } else {
                alert(message); // Fallback if toast element missing
            }
        }
    </script>
</body>
</html>